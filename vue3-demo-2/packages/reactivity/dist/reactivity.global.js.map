{"version":3,"file":"reactivity.global.js","sources":["../../shared/src/index.ts","../src/baseHandlers.ts","../src/reactive.ts"],"sourcesContent":["export const isObject = (value) => typeof value == 'object' && value !== null; // 判断是否是对象\nexport const extend = Object.assign","import { isObject,extend } from '@vue/shared';\nimport { readonly,reactive } from './reactive';\n// 只读的属性set会被报异常\n// 是不是深度\n\nconst get = createGetter();\nconst shallowGet = createGetter(false, true);\nconst readonlyGet = createGetter(true);\nconst shallowReadonlyGet = createGetter(true, true);\n\nconst set = createSetter(false)\nconst shallowSet = createSetter(true)\n\n\nfunction createGetter(isReadonly = false, shallow = false) { // 拦截获取功能\n  return function get(target,key, receiver) {\n    const res = Reflect.get(target,key,receiver) // target[key]\n    if(!isReadonly) {\n      // 不是只读, 收集依赖,等会数据变化后更新对应的视图\n    }\n    if(shallow) {\n      return res;\n    }\n    if(isObject(res)) { // vue2是一上来就递归, vue2是当取值的时候进行代理,vue3的代理模式是懒代理\n      return isReadonly ? readonly(res) : reactive(res)\n    }\n\n    return res\n  }\n}\nfunction createSetter(shallow = false) { // 拦截设置功能\n  return function set(target,key,value,receiver) {\n    const result = Reflect.set(target,key,value,receiver) // target[key] = value\n    return result\n  }\n}\n\nlet readonlyObj = {\n  set: (target, key) => {\n    console.log(`set on key ${key} falied, beacause key is readonly attr`)\n  }\n}\n\nexport const mutableHandlers = {\n  get,\n  set\n}\nexport const shallowReactiveHandlers = {\n  get: shallowGet,\n  set: shallowSet\n}\nexport const readonlyHandlers = extend({\n  get: readonlyGet,\n}, readonlyObj)\nexport const shallowReadonlyHandlers = extend({\n  get: shallowReadonlyGet,\n}, readonlyObj)","import { isObject } from '@vue/shared';\n\nimport {\n  mutableHandlers,\n  shallowReactiveHandlers,\n  readonlyHandlers, \n  shallowReadonlyHandlers\n} from './baseHandlers'\n\nexport function reactive(target) {\n  return createReactiveObject(target, false, mutableHandlers, false)\n}\nexport function shallowReactive(target) {\n  return createReactiveObject(target, false, shallowReactiveHandlers, true)\n}\nexport function readonly(target) {\n  return createReactiveObject(target, true, readonlyHandlers, false)\n\n}\nexport function shallowReadonly(target) {\n  return createReactiveObject(target, true, shallowReadonlyHandlers, true)\n}\n// 是不是只读   是不是深度\nconst reactiveMap = new WeakMap() // WeakMap 会自动垃圾回收, 不会造成内存泄漏,存储的key必须是对象\nconst readonlyMap = new WeakMap() // \n\nexport function createReactiveObject(target, isReadonly, baseHandlers, isShallow) {\n  // 如果目标不是对象, 没法拦截了, reactive这个api只能用来拦截对象类型\n  if (!isObject(target)) {\n    return target;\n  }\n  // 如果某个对象被代理了就不需要被再次代理 可能一个对象被代理一次,又被只读代理\n  const proxyMap = isReadonly ? readonlyMap : reactiveMap\n  // 判断之前是否存在过代理\n  const existProxy = proxyMap.get(target);\n  if (existProxy) {\n    return existProxy // 如果存在代理过  返回代理的对象即可\n  }\n  const proxy = new Proxy(target, baseHandlers)\n  proxyMap.set(target, proxy); // 将要代理的对象 和 对应代理结果缓存起来\n  return proxy\n}\n"],"names":[],"mappings":"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"}